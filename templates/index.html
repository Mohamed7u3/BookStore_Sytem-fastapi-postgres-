<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>üìö Bookstore</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="container py-4">

    <h1 class="mb-4 text-center">üìö Bookstore</h1>

    <!-- Add Book Form -->
    <div class="card mb-4">
        <div class="card-body">
            <h5>Add New Book</h5>
            <form id="bookForm" class="row g-3">
                <div class="col-md-3">
                    <input type="text" id="title" class="form-control" placeholder="Title" required>
                </div>
                <div class="col-md-3">
                    <input type="text" id="author" class="form-control" placeholder="Author" required>
                </div>
                <div class="col-md-3">
                    <input type="text" id="description" class="form-control" placeholder="Description" required>
                </div>
                <div class="col-md-2">
                    <input type="number" id="year" class="form-control" placeholder="Year" min="1500" max="2025" required>
                </div>
                <div class="col-md-1">
                    <button type="submit" class="btn btn-primary w-100">Add</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Books Table -->
    <div class="card">
        <div class="card-body">
            <h5>Book List</h5>
            <table class="table table-striped" id="booksTable">
                <thead>
                    <tr>
                        <th>üìñ Title</th>
                        <th>üë§ Author</th>
                        <th>üìù Description</th>
                        <th>üìÖ Year</th>
                        <th>‚öôÔ∏è Actions</th>
                    </tr>
                </thead>
                <tbody></tbody>
            </table>
        </div>
    </div>

    <!-- Edit Modal -->
    <div class="modal fade" id="editModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5>Edit Book</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <input type="hidden" id="editId">
                    <input type="text" id="editTitle" class="form-control mb-2" placeholder="Title">
                    <input type="text" id="editAuthor" class="form-control mb-2" placeholder="Author">
                    <input type="text" id="editDescription" class="form-control mb-2" placeholder="Description">
                    <input type="number" id="editYear" class="form-control mb-2" placeholder="Year">
                </div>
                <div class="modal-footer">
                    <button class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button class="btn btn-success" onclick="saveEdit()">Save</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        const apiUrl = "/books/";

        async function loadBooks() {
            const res = await fetch(apiUrl);
            const books = await res.json();
            const tbody = document.querySelector("#booksTable tbody");
            tbody.innerHTML = "";
            books.forEach(b => {
                tbody.innerHTML += `
                    <tr>
                        <td>${b.title}</td>
                        <td>${b.author}</td>
                        <td>${b.description}</td>
                        <td>${b.year}</td>
                        <td>
                            <button class="btn btn-sm btn-warning" onclick="openEdit(${b.id}, '${b.title}', '${b.author}', '${b.description}', ${b.year})">Edit</button>
                            <button class="btn btn-sm btn-danger" onclick="deleteBook(${b.id})">Delete</button>
                        </td>
                    </tr>
                `;
            });
        }

        // Add Book
        document.getElementById("bookForm").addEventListener("submit", async (e) => {
            e.preventDefault();
            const book = {
                title: document.getElementById("title").value,
                author: document.getElementById("author").value,
                description: document.getElementById("description").value,
                year: parseInt(document.getElementById("year").value)
            };
            const res = await fetch(apiUrl, {
                method: "POST",
                headers: {"Content-Type": "application/json"},
                body: JSON.stringify(book)
            });
            if (res.ok) {
                e.target.reset();
                loadBooks();
            } else {
                alert("‚ùå Error adding book!");
            }
        });

        // Delete Book
        async function deleteBook(id) {
            if (confirm("Are you sure you want to delete this book?")) {
                await fetch(apiUrl + id, {method: "DELETE"});
                loadBooks();
            }
        }

        // Edit Book
        function openEdit(id, title, author, description, year) {
            document.getElementById("editId").value = id;
            document.getElementById("editTitle").value = title;
            document.getElementById("editAuthor").value = author;
            document.getElementById("editDescription").value = description;
            document.getElementById("editYear").value = year;
            new bootstrap.Modal(document.getElementById("editModal")).show();
        }

        async function saveEdit() {
            const id = document.getElementById("editId").value;
            const updatedBook = {
                title: document.getElementById("editTitle").value,
                author: document.getElementById("editAuthor").value,
                description: document.getElementById("editDescription").value,
                year: parseInt(document.getElementById("editYear").value)
            };
            await fetch(apiUrl + id, {
                method: "PUT",
                headers: {"Content-Type": "application/json"},
                body: JSON.stringify(updatedBook)
            });
            bootstrap.Modal.getInstance(document.getElementById("editModal")).hide();
            loadBooks();
        }

        loadBooks();
    </script>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
